!function(e,t){function i(){this._events=new Object}function s(e){e&&(e.delimiter&&(this.delimiter=e.delimiter),e.maxListeners&&(this._events.maxListeners=e.maxListeners),e.wildcard&&(this.wildcard=e.wildcard),this.wildcard&&(this.listenerTree=new Object))}function o(e){this._events=new Object,s.call(this,e)}function u(e,t,n,r){if(!n)return[];var i=[],s,o,a,f,l,c,h,p=t.length,d=t[r],v=t[r+1];if(r===p&&n._listeners){if(typeof n._listeners=="function")return e&&e.push(n._listeners),[n];for(s=0,o=n._listeners.length;s<o;s++)e&&e.push(n._listeners[s]);return[n]}if(d==="*"||d==="**"||n[d]){if(d==="*"){for(a in n)a!=="_listeners"&&n.hasOwnProperty(a)&&(i=i.concat(u(e,t,n[a],r+1)));return i}if(d==="**"){h=r+1===p||r+2===p&&v==="*",h&&n._listeners&&(i=i.concat(u(e,t,n,p)));for(a in n)a!=="_listeners"&&n.hasOwnProperty(a)&&(a==="*"||a==="**"?(n[a]._listeners&&!h&&(i=i.concat(u(e,t,n[a],p))),i=i.concat(u(e,t,n[a],r))):a===v?i=i.concat(u(e,t,n[a],r+2)):i=i.concat(u(e,t,n[a],r)));return i}i=i.concat(u(e,t,n[d],r+1))}f=n["*"],f&&u(e,t,f,r+1),l=n["**"];if(l)if(r<p){l._listeners&&u(e,t,l,p);for(a in l)a!=="_listeners"&&l.hasOwnProperty(a)&&(a===v?u(e,t,l[a],r+2):a===d?u(e,t,l[a],r+1):(c={},c[a]=l[a],u(e,t,{"**":c},r+1)))}else l._listeners?u(e,t,l,p):l["*"]&&l["*"]._listeners&&u(e,t,l["*"],p);return i}function a(e,t){e=typeof e=="string"?e.split(this.delimiter):e.slice();for(var i=0,s=e.length;i+1<s;i++)if(e[i]==="**"&&e[i+1]==="**")return;var o=this.listenerTree,u=e.shift();while(u){o[u]||(o[u]=new Object),o=o[u];if(e.length===0){if(!o._listeners)o._listeners=t;else if(typeof o._listeners=="function")o._listeners=[o._listeners,t];else if(n(o._listeners)){o._listeners.push(t);if(!o._listeners.warned){var a=r;typeof this._events.maxListeners!="undefined"&&(a=this._events.maxListeners),a>0&&o._listeners.length>a&&(o._listeners.warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",o._listeners.length),console.trace())}}return!0}u=e.shift()}return!0}var n=Array.isArray?Array.isArray:function(t){return Object.prototype.toString.call(t)==="[object Array]"},r=10;o.prototype.delimiter=".",o.prototype.setMaxListeners=function(e){this._events||i.call(this),this._events.maxListeners=e},o.prototype.event="",o.prototype.once=function(e,t){return this.many(e,1,t),this},o.prototype.many=function(e,t,n){function i(){--t===0&&r.off(e,i),n.apply(this,arguments)}var r=this;if(typeof n!="function")throw new Error("many only accepts instances of Function");return i._origin=n,this.on(e,i),r},o.prototype.emit=function(){this._events||i.call(this);var e=arguments[0];if(e==="newListener"&&!this._events.newListener)return!1;if(this._all){var t=arguments.length,n=new Array(t-1);for(var r=1;r<t;r++)n[r-1]=arguments[r];for(r=0,t=this._all.length;r<t;r++)this.event=e,this._all[r].apply(this,n)}if(e==="error"&&!this._all&&!this._events.error&&(!this.wildcard||!this.listenerTree.error))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");var s;if(this.wildcard){s=[];var o=typeof e=="string"?e.split(this.delimiter):e.slice();u.call(this,s,o,this.listenerTree,0)}else s=this._events[e];if(typeof s=="function"){this.event=e;if(arguments.length===1)s.call(this);else if(arguments.length>1)switch(arguments.length){case 2:s.call(this,arguments[1]);break;case 3:s.call(this,arguments[1],arguments[2]);break;default:var t=arguments.length,n=new Array(t-1);for(var r=1;r<t;r++)n[r-1]=arguments[r];s.apply(this,n)}return!0}if(s){var t=arguments.length,n=new Array(t-1);for(var r=1;r<t;r++)n[r-1]=arguments[r];var a=s.slice();for(var r=0,t=a.length;r<t;r++)this.event=e,a[r].apply(this,n);return a.length>0||this._all}return this._all},o.prototype.on=function(e,t){if(typeof e=="function")return this.onAny(e),this;if(typeof t!="function")throw new Error("on only accepts instances of Function");this._events||i.call(this),this.emit("newListener",e,t);if(this.wildcard)return a.call(this,e,t),this;if(!this._events[e])this._events[e]=t;else if(typeof this._events[e]=="function")this._events[e]=[this._events[e],t];else if(n(this._events[e])){this._events[e].push(t);if(!this._events[e].warned){var s=r;typeof this._events.maxListeners!="undefined"&&(s=this._events.maxListeners),s>0&&this._events[e].length>s&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),console.trace())}}return this},o.prototype.onAny=function(e){this._all||(this._all=[]);if(typeof e!="function")throw new Error("onAny only accepts instances of Function");return this._all.push(e),this},o.prototype.addListener=o.prototype.on,o.prototype.off=function(e,t){if(typeof t!="function")throw new Error("removeListener only takes instances of Function");var r,i=[];if(this.wildcard){var s=typeof e=="string"?e.split(this.delimiter):e.slice();i=u.call(this,null,s,this.listenerTree,0)}else{if(!this._events[e])return this;r=this._events[e],i.push({_listeners:r})}for(var o=0;o<i.length;o++){var a=i[o];r=a._listeners;if(n(r)){var f=-1;for(var l=0,c=r.length;l<c;l++)if(r[l]===t||r[l].listener&&r[l].listener===t||r[l]._origin&&r[l]._origin===t){f=l;break}if(f<0)return this;this.wildcard?a._listeners.splice(f,1):this._events[e].splice(f,1),r.length===0&&(this.wildcard?delete a._listeners:delete this._events[e])}else if(r===t||r.listener&&r.listener===t||r._origin&&r._origin===t)this.wildcard?delete a._listeners:delete this._events[e]}return this},o.prototype.offAny=function(e){var t=0,n=0,r;if(e&&this._all&&this._all.length>0){r=this._all;for(t=0,n=r.length;t<n;t++)if(e===r[t])return r.splice(t,1),this}else this._all=[];return this},o.prototype.removeListener=o.prototype.off,o.prototype.removeAllListeners=function(e){if(arguments.length===0)return!this._events||i.call(this),this;if(this.wildcard){var t=typeof e=="string"?e.split(this.delimiter):e.slice(),n=u.call(this,null,t,this.listenerTree,0);for(var r=0;r<n.length;r++){var s=n[r];s._listeners=null}}else{if(!this._events[e])return this;this._events[e]=null}return this},o.prototype.listeners=function(e){if(this.wildcard){var t=[],r=typeof e=="string"?e.split(this.delimiter):e.slice();return u.call(this,t,r,this.listenerTree,0),t}return this._events||i.call(this),this._events[e]||(this._events[e]=[]),n(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]},o.prototype.listenersAny=function(){return this._all?this._all:[]},typeof define=="function"&&define.amd?define(function(){return o}):e.EventEmitter2=o}(typeof process!="undefined"&&typeof process.title!="undefined"&&typeof exports!="undefined"?exports:window);var Sink=this.Sink=function(e){function t(e,n,r,i){var s=t.sinks.list,o;for(o=0;o<s.length;o++)if(s[o].enabled)try{return new s[o](e,n,r,i)}catch(u){}throw t.Error(2)}function n(){}function r(e,n,i,s,o){i=i||n.prototype,n.prototype=new t.SinkClass,n.prototype.type=e,n.enabled=!s;var u;for(u in i)i.hasOwnProperty(u)&&(n.prototype[u]=i[u]);r[e]=n,r.list[o?"unshift":"push"](n)}return t.SinkClass=n,n.prototype=t.prototype={sampleRate:44100,channelCount:2,bufferSize:4096,writePosition:0,previousHit:0,ringOffset:0,channelMode:"interleaved",isReady:!1,start:function(e,n,r,i){this.channelCount=isNaN(n)||n===null?this.channelCount:n,this.bufferSize=isNaN(r)||r===null?this.bufferSize:r,this.sampleRate=isNaN(i)||i===null?this.sampleRate:i,this.readFn=e,this.activeRecordings=[],this.previousHit=+(new Date),t.EventEmitter.call(this),t.emit("init",[this].concat([].slice.call(arguments)))},process:function(e,n){this.emit("preprocess",arguments),this.ringBuffer&&(this.channelMode==="interleaved"?this.ringSpin:this.ringSpinInterleaved).apply(this,arguments);if(this.channelMode==="interleaved")this.emit("audioprocess",arguments),this.readFn&&this.readFn.apply(this,arguments);else{var r=t.deinterleave(e,this.channelCount),i=[r].concat([].slice.call(arguments,1));this.emit("audioprocess",i),this.readFn&&this.readFn.apply(this,i),t.interleave(r,this.channelCount,e)}this.emit("postprocess",arguments),this.previousHit=+(new Date),this.writePosition+=e.length/n},getPlaybackTime:function(){return this.writePosition-this.bufferSize},ready:function(){if(this.isReady)return;this.isReady=!0,this.emit("ready",[])}},t.sinks=t.devices=r,t.sinks.list=[],t.singleton=function(){var e=t.apply(null,arguments);return t.singleton=function(){return e},e},e.Sink=t,t}(function(){return this}());void function(e){function t(){var e;for(e in t.prototype)t.prototype.hasOwnProperty(e)&&(this[e]=t.prototype[e]);this._listeners={}}t.prototype={_listeners:null,emit:function(e,t){if(this._listeners[e])for(var n=0;n<this._listeners[e].length;n++)this._listeners[e][n].apply(this,t);return this},on:function(e,t){return this._listeners[e]=this._listeners[e]||[],this._listeners[e].push(t),this},off:function(e,t){if(this._listeners[e]){if(!t)return delete this._listeners[e],this;for(var n=0;n<this._listeners[e].length;n++)this._listeners[e][n]===t&&this._listeners[e].splice(n--,1);this._listeners[e].length||delete this._listeners[e]}return this}},e.EventEmitter=t,t.call(e)}(this.Sink),void function(e){e.doInterval=function(t,n){function s(s){e.inlineWorker.working&&!s?(r=e.inlineWorker('setInterval(function (){ postMessage("tic"); }, '+n+");"),r.onmessage=function(){t()},i=function(){r.terminate()}):(r=setInterval(t,n),i=function(){clearInterval(r)})}var r,i;return e.inlineWorker.ready?s():e.inlineWorker.on("ready",function(){s()}),function(){i?i():e.inlineWorker.ready||e.inlineWorker.on("ready",function(){i&&i()})}}}(this.Sink),void function(e){var t,n,r,i;void function(e,s){function o(e,t){var n,r=t.slice();for(n=r.shift();typeof n!="undefined";n=r.shift()){n=Function("return typeof "+n+e+'=== "undefined" ? undefined : '+n+e)();if(n)return n}}t=o("Blob",e),n=o("BlobBuilder",e),r=o("URL",s),i=o("btoa",[""])}(["","Moz","WebKit","MS"],["","webkit"]);var s=t&&r&&function(e,n){return r.createObjectURL(new t([e],{type:n}))},o=n&&r&&function(e,t){var i=new n;return i.append(e),r.createObjectURL(i.getBlob(t))},u=i&&function(e,t){return"data:"+t+";base64,"+i(e)},a=s||o||u;if(!a)return;s&&(a.createBlob=s),o&&(a.createBlobBuilder=o),u&&(a.createData=u),t&&(a.Blob=t),n&&(a.BlobBuilder=n),r&&(a.URL=r),e.createDynURL=a,e.revokeDynURL=function(e){return typeof e=="string"&&e.indexOf("data:")===0?!1:r.revokeObjectURL(e)}}(this.Sink),void function(e){function t(e){if(!t.hasOwnProperty(e))throw t(1);if(!(this instanceof t))return new t(e);var n;for(n in t[e])t[e].hasOwnProperty(n)&&(this[n]=t[e][n]);this.code=e}t.prototype=new Error,t.prototype.toString=function(){return"SinkError 0x"+this.code.toString(16)+": "+this.message},t[1]={message:"No such error code.",explanation:"The error code does not exist."},t[2]={message:"No audio sink available.",explanation:"The audio device may be busy, or no supported output API is available for this browser."},t[16]={message:"Buffer underflow.",explanation:"Trying to recover..."},t[17]={message:"Critical recovery fail.",explanation:"The buffer underflow has reached a critical point, trying to recover, but will probably fail anyway."},t[18]={message:"Buffer size too large.",explanation:"Unable to allocate the buffer due to excessive length, please try a smaller buffer. Buffer size should probably be smaller than the sample rate."},e.Error=t}(this.Sink),void function(e){function n(){return t(this,"terminate",this._terminate),e.revokeDynURL(this._url),delete this._url,delete this._terminate,this.terminate()}function r(i){function s(e,i,s){try{var o=e(i,"text/javascript"),u=new Worker(o);return t(u,"_url",o),t(u,"_terminate",u.terminate),t(u,"terminate",n),r.type?u:(r.type=s,r.createURL=e,u)}catch(a){return null}}var o=e.createDynURL,u;return r.createURL?s(r.createURL,i,r.type):(u=s(o.createBlob,i,"blob"),u?u:(u=s(o.createBlobBuilder,i,"blobbuilder"),u?u:(u=s(o.createData,i,"data"),u)))}var t=Object.defineProperty?function(e,t,n){Object.defineProperty(e,t,{value:n,configurable:!0,writable:!0})}:function(e,t,n){e[t]=n};e.EventEmitter.call(r),r.test=function(){function n(t){if(r.ready)return;r.ready=!0,r.working=t,r.emit("ready",[t]),r.off("ready"),t&&e&&e.terminate(),e=null}r.ready=r.working=!1,r.type="",r.createURL=null;var e=r("this.onmessage=function(e){postMessage(e.data)}"),t="inlineWorker";e?(e.onmessage=function(e){n(e.data===t)},e.postMessage(t),setTimeout(function(){n(!1)},1e3)):setTimeout(function(){n(!1)},0)},e.inlineWorker=r,r.test()}(this.Sink),void function(e){e.sinks("audiodata",function(){function c(){if(r){s=i.mozWriteAudio(r),n+=s;if(s<r.length)return r=r.subarray(s),r;r=null}o=i.mozCurrentSampleOffset(),u=Number(o+(f!==o?t.bufferSize:t.preBufferSize)*t.channelCount-n),o===f&&t.emit("error",[e.Error(16)]);if(u>0||f===o){t.ready();try{a=new Float32Array(f===o?t.preBufferSize*t.channelCount:t.forceBufferSize?u<t.bufferSize*2?t.bufferSize*2:u:u)}catch(l){t.emit("error",[e.Error(18)]),t.kill();return}t.process(a,t.channelCount),s=t._audio.mozWriteAudio(a),s<a.length&&(r=a.subarray(s)),n+=s}f=o}var t=this,n=0,r=null,i=new Audio,s,o,u,a,f,l;t.start.apply(t,arguments),t.preBufferSize=isNaN(arguments[4])||arguments[4]===null?this.preBufferSize:arguments[4],i.mozSetup(t.channelCount,t.sampleRate),this._timers=[],this._timers.push(e.doInterval(function(){+(new Date)-t.previousHit>2e3&&(t._audio=i=new Audio,i.mozSetup(t.channelCount,t.sampleRate),n=0,t.emit("error",[e.Error(17)]))},1e3)),this._timers.push(e.doInterval(c,t.interval)),t._bufferFill=c,t._audio=i},{bufferSize:24576,preBufferSize:24576,forceBufferSize:!1,interval:100,kill:function(){while(this._timers.length)this._timers.shift()();this.emit("kill")},getPlaybackTime:function(){return this._audio.mozCurrentSampleOffset()/this.channelCount}},!1,!0),e.sinks.moz=e.sinks.audiodata}(this.Sink),void function(e){e.sinks("dummy",function(){function n(){var e=new Float32Array(t.bufferSize*t.channelCount);t.process(e,t.channelCount)}var t=this;t.start.apply(t,arguments),t._kill=e.doInterval(n,t.bufferSize/t.sampleRate*1e3),t._callback=n},{kill:function(){this._kill(),this.emit("kill")}},!0)}(this.Sink),function(e,t){function n(e){var t=document.createElement("audio");return e&&(t.src=e),t}function r(){var e=this;e.currentFrame=n(),e.nextFrame=n(),e._onended=function(){e.samples+=e.bufferSize,e.nextClip()}}t=e.sinks,t("wav",function(){function a(){if(r._audio.hasNextFrame)return;r.ready(),e.memcpy(u,0,o,0),r.process(o,r.channelCount),r._audio.setSource("data:audio/wav;base64,"+btoa(audioLib.PCMData.encode({data:o,sampleRate:r.sampleRate,channelCount:r.channelCount,bytesPerSample:r.quality}))),r._audio.currentFrame.src||r._audio.nextClip()}var r=this,i=new t.wav.wavAudio,s=typeof s=="undefined"?audioLib.PCMData:s;r.start.apply(r,arguments);var o=new Float32Array(r.bufferSize*r.channelCount),u=new Float32Array(r.bufferSize*r.channelCount);if(!n().canPlayType("audio/wav; codecs=1")||!btoa)throw 0;r.kill=e.doInterval(a,40),r._bufferFill=a,r._audio=i},{quality:1,bufferSize:22050,getPlaybackTime:function(){var e=this._audio;return(e.currentFrame?e.currentFrame.currentTime*this.sampleRate:0)+e.samples}}),r.prototype={samples:0,nextFrame:null,currentFrame:null,_onended:null,hasNextFrame:!1,nextClip:function(){var e=this.currentFrame;this.currentFrame=this.nextFrame,this.nextFrame=e,this.hasNextFrame=!1,this.currentFrame.play()},setSource:function(e){this.nextFrame.src=e,this.nextFrame.addEventListener("ended",this._onended,!0),this.hasNextFrame=!0}},t.wav.wavAudio=r}(this.Sink),function(e,t){var n=typeof window=="undefined"?null:window.webkitAudioContext||window.AudioContext;e("webaudio",function(n,r,i,s){function c(e){var t=e.outputBuffer,n=t.numberOfChannels,r,i,s=t.length,u=t.size,a=new Array(n),c;o.ready(),f=f&&f.length===s*n?f:new Float32Array(s*n),l=l&&l.length===f.length?l:new Float32Array(s*n),f.set(l);for(r=0;r<n;r++)a[r]=t.getChannelData(r);o.process(f,o.channelCount);for(r=0;r<s;r++)for(i=0;i<n;i++)a[i][r]=f[r*o.channelCount+i]}var o=this,u=e.webaudio.getContext(),a=null,f=null,l=null;o.start.apply(o,arguments),a=u.createJavaScriptNode(o.bufferSize,o.channelCount,o.channelCount),o.sampleRate=u.sampleRate,a.onaudioprocess=c,a.connect(u.destination),o._context=u,o._node=a,o._callback=c,t.push(a)},{kill:function(){this._node.disconnect(0);for(var e=0;e<t.length;e++)t[e]===this._node&&t.splice(e--,1);this._node=this._context=null,this.emit("kill")},getPlaybackTime:function(){return this._context.currentTime*this.sampleRate}},!1,!0),e.webkit=e.webaudio,e.webaudio.fix82795=t,e.webaudio.getContext=function(){var t=new n;return e.webaudio.getContext=function(){return t},t}}(this.Sink.sinks,[]),function(e){e.sinks("worker",function(){function s(t){e.isReady||e.initMSP(t),e.ready();var s=e.channelCount,o=t.audioLength,u,a;n=n&&n.length===o*s?n:new Float32Array(o*s),r=r&&r.length===n.length?r:new Float32Array(o*s),i=i&&i.length===n.length?i:new Float32Array(o*s),n.set(i),r.set(i),e.process(n,e.channelCount);for(u=0;u<s;u++)for(a=0;a<o;a++)r[u*t.audioLength+a]=n[u+a*s];t.writeAudio(r)}function o(t){e.isReady||e.initWA(t),e.ready();var r=t.outputBuffer,s=r.numberOfChannels,o,u,a=r.length,f=r.size,l=new Array(s),c;n=n&&n.length===a*s?n:new Float32Array(a*s),i=i&&i.length===n.length?i:new Float32Array(a*s),n.set(i);for(o=0;o<s;o++)l[o]=r.getChannelData(o);e.process(n,e.channelCount);for(o=0;o<a;o++)for(u=0;u<s;u++)l[u][o]=n[o*e.channelCount+u]}var e=this,t=function(){return this}(),n=null,r=null,i=null;e.start.apply(e,arguments),importScripts(),t.onprocessmedia=s,t.onaudioprocess=o,e._mspBufferFill=s,e._waBufferFill=o},{ready:!1,initMSP:function(e){this.channelCount=e.audioChannels,this.sampleRate=e.audioSampleRate,this.bufferSize=e.audioLength*this.channelCount,this.ready=!0,this.emit("ready",[])},initWA:function(e){var t=e.outputBuffer;this.channelCount=t.numberOfChannels,this.sampleRate=t.sampleRate,this.bufferSize=t.length*this.channelCount,this.ready=!0,this.emit("ready",[])}})}(this.Sink),function(e){e.deinterleave=function(e,t){var n=e.length,r=n/t,i=[],s,o;for(s=0;s<t;s++){i[s]=new Float32Array(r);for(o=0;o<r;o++)i[s][o]=e[o*t+s]}return i},e.interleave=function(e,t,n){t=t||e.length;var r=e[0].length,i=e.length,s,o;n=n||new Float32Array(r*t);for(s=0;s<i;s++)for(o=0;o<r;o++)n[s+o*t]=e[s][o];return n},e.mix=function(e){var t=[].slice.call(arguments,1),n,r,i;for(i=0;i<t.length;i++){n=Math.max(e.length,t[i].length);for(r=0;r<n;r++)e[r]+=t[i][r]}return e},e.resetBuffer=function(e){var t=e.length,n;for(n=0;n<t;n++)e[n]=0;return e},e.clone=function(e,t){var n=e.length,r;t=t||new Float32Array(n);for(r=0;r<n;r++)t[r]=e[r];return t},e.createDeinterleaved=function(e,t){var n=new Array(t),r;for(r=0;r<t;r++)n[r]=new Float32Array(e);return n},e.memcpy=function(e,t,n,r,i){e=e.subarray||e.slice?e:e.buffer,n=n.subarray||n.slice?n:n.buffer,e=t?e.subarray?e.subarray(t,i&&t+i):e.slice(t,i&&t+i):e;if(n.set)n.set(e,r);else for(var s=0;s<e.length;s++)n[s+r]=e[s];return n},e.memslice=function(e,t,n){return e.subarray?e.subarray(t,n):e.slice(t,n)},e.mempad=function(t,n,r){return n=n.length?n:new t.constructor(n),e.memcpy(t,0,n,r),n},e.linspace=function(e,t,n){var r,i,s,o;n=n.length?(r=n.length)&&n:Array(r=n),o=(t-e)/--r;for(s=e+o,i=1;i<r;i++,s+=o)n[i]=s;return n[0]=e,n[r]=t,n},e.ftoi=function(e,t,n){var r,i=Math.pow(2,t-1);n=n||new e.constructor(e.length);for(r=0;r<e.length;r++)n[r]=~~(i*e[r]);return n}}(this.Sink),function(e){function t(t,n){e.EventEmitter.call(this),this.bufferSize=isNaN(t)||t===null?this.bufferSize:t,this.channelCount=isNaN(n)||n===null?this.channelCount:n;var r=this;this.callback=function(){return r.process.apply(r,arguments)},this.resetBuffer()}t.prototype={buffer:null,zeroBuffer:null,parentSink:null,bufferSize:4096,channelCount:2,offset:null,resetBuffer:function(){this.buffer=new Float32Array(this.bufferSize),this.zeroBuffer=new Float32Array(this.bufferSize)},process:function(e,t){this.offset===null&&this.loadBuffer();for(var n=0;n<e.length;n++)this.offset>=this.buffer.length&&this.loadBuffer(),e[n]=this.buffer[this.offset++]},loadBuffer:function(){this.offset=0,e.memcpy(this.zeroBuffer,0,this.buffer,0),this.emit("audioprocess",[this.buffer,this.channelCount])}},e.Proxy=t,e.prototype.createProxy=function(t){var n=new e.Proxy(t,this.channelCount);return n.parentSink=this,this.on("audioprocess",n.callback),n}}(this.Sink),function(e){(function(){function t(n,r){return n&&r?t[n]=r:n&&t[n]instanceof Function&&(e.interpolate=t[n]),t[n]}e.interpolation=t,t("linear",function(e,t){var n=Math.floor(t),r=n+1,i=t-n;return r=r<e.length?r:0,e[n]*(1-i)+e[r]*i}),t("nearest",function(e,t){return t>=e.length-.5?e[0]:e[Math.round(t)]}),t("linear")})(),e.resample=function(t,n,r,i,s){var o=arguments.length,u=o===2?n:o===3?n/r:i/n*s/r,a=t.length,f=Math.ceil(a/u),l=new Float32Array(f),c,h;for(c=0,h=0;c<a;c+=u)l[h++]=e.interpolate(t,c);return l}}(this.Sink),void function(e){function t(e){this.boundTo=e,this.buffers=[],e.activeRecordings.push(this)}e.on("init",function(e){e.activeRecordings=[],e.on("postprocess",e.recordData)}),e.prototype.activeRecordings=null,e.prototype.record=function(){var t=new e.Recording(this);return this.emit("record",[t]),t},e.prototype.recordData=function(e){var t=this.activeRecordings,n,r=t.length;for(n=0;n<r;n++)t[n].add(e)},t.prototype={add:function(e){this.buffers.push(e)},clear:function(){this.buffers=[]},stop:function(){var e=this.boundTo.activeRecordings,t;for(t=0;t<e.length;t++)e[t]===this&&e.splice(t--,1)},join:function(){var e=0,t=0,n=this.buffers,r,i,s,o=n.length;for(s=0;s<o;s++)e+=n[s].length;r=new Float32Array(e);for(s=0;s<o;s++){for(i=0;i<n[s].length;i++)r[t+i]=n[s][i];t+=n[s].length}return r}},e.Recording=t}(this.Sink),void function(e){function t(){this.ringBuffer&&(this.channelMode==="interleaved"?this.ringSpin:this.ringSpinInterleaved).apply(this,arguments)}e.on("init",function(e){e.on("preprocess",t)}),e.prototype.ringBuffer=null,e.prototype.ringSpin=function(e){var t=this.ringBuffer,n=e.length,r=t.length,i=this.ringOffset,s;for(s=0;s<n;s++)e[s]+=t[i],i=(i+1)%r;this.ringOffset=i},e.prototype.ringSpinDeinterleaved=function(e){var t=this.ringBuffer,n=e.length,r=t.length,i=t[0].length,s=r*i,o=this.ringOffset,u,a;for(u=0;u<n;u+=r){for(a=0;a<r;a++)e[u+a]+=t[a][o];o=(o+1)%i}this.ringOffset=a}}(this.Sink),void function(e,t){t=e.prototype,e.on("init",function(e){e.asyncBuffers=[],e.syncBuffers=[],e.on("preprocess",e.writeBuffersSync),e.on("postprocess",e.writeBuffersAsync)}),t.writeMode="async",t.asyncBuffers=t.syncBuffers=null,t.writeBuffersAsync=function(e){var t=this.asyncBuffers,n=e.length,r,i,s,o,u;if(t)for(s=0;s<t.length;s++){r=t[s],i=r.b.length,u=r.d,r.d-=Math.min(u,n);for(o=0;o+u<n&&o<i;o++)e[o+u]+=r.b[o];r.b=r.b.subarray(o+u),s>=i&&t.splice(s--,1)}},t.writeBuffersSync=function(e){var t=this.syncBuffers,n=e.length,r=0,i=0;for(;r<n&&t.length;r++){e[r]+=t[0][i];if(t[0].length<=i){t.splice(0,1),i=0;continue}i++}t.length&&(t[0]=t[0].subarray(i))},t.writeBufferAsync=function(t,n){t=this.mode==="deinterleaved"?e.interleave(t,this.channelCount):t;var r=this.asyncBuffers;return r.push({b:t,d:isNaN(n)?~~((+(new Date)-this.previousHit)/1e3*this.sampleRate):n}),r.length},t.writeBufferSync=function(t){t=this.mode==="deinterleaved"?e.interleave(t,this.channelCount):t;var n=this.syncBuffers;return n.push(t),n.length},t.writeBuffer=function(){return this[this.writeMode==="async"?"writeBufferAsync":"writeBufferSync"].apply(this,arguments)},t.getSyncWriteOffset=function(){var e=this.syncBuffers,t=0,n;for(n=0;n<e.length;n++)t+=e[n].length;return t}}(this.Sink),function(){this.EventEmitter=EventEmitter2;var e=this.Pd={sampleRate:44100,blockSize:128,channelCount:2,debugMode:!1,arrayType:Array,arraySlice:function(e,t){return e.slice(t)}};typeof Float32Array!="undefined"&&(e.arrayType=Float32Array,e.arraySlice=function(e,t){return e.subarray(t)}),e.isSupported=function(){var e=typeof window=="undefined"?null:window.webkitAudioContext||window.AudioContext;if(e)return!0;var t=new Audio;return t.mozSetup?!0:!1},e.register=function(t){if(t.type==="abstract")return;if(t instanceof e.Patch)this._patches.indexOf(t)===-1&&(this._patches.push(t),t.id=this._generateId());else if(t instanceof e.NamedObject){var n=function(n,r){var i=t.type,s=e._namedObjects[t.type],o;s||(s=e._namedObjects[i]={}),o=s[r],o||(o=s[r]=[]),o.indexOf(t)===-1&&o.push(t),n&&(o=s[n],o.splice(o.indexOf(t),1))};t.on("change:name",n),n(null,t.name)}else if(t instanceof e.UniquelyNamedObject){var n=function(n,r){var i=t.type,s=e._uniquelyNamedObjects[t.type],o;s||(s=e._uniquelyNamedObjects[i]={});if(s.hasOwnProperty(r)&&s[r]!==t)throw new Error('there is already an object with name "'+r+'"');s[r]=t,n&&(s[n]=undefined)};t.on("change:name",n),n(null,t.name)}},e._patches=[],e._namedObjects={},e._uniquelyNamedObjects={},e.getNamedObject=function(e,t){return(this._namedObjects[e]||{})[t]||[]},e.getUniquelyNamedObject=function(e,t){return(this._uniquelyNamedObjects[e]||{})[t]||null},e.isArray=Array.isArray||function(e){return toString.call(e)==="[object Array]"},e.isNumber=function(e){return typeof e=="number"&&!isNaN(e)},e.isString=function(e){return typeof e=="string"},e.extend=function(e){var t=Array.prototype.slice.call(arguments,1),n,r,i,s;for(n=0,r=t.length;n<r;n++){i=t[n];for(s in i)e[s]=i[s]}return e},e.chainExtend=function(){var t=Array.prototype.slice.call(arguments,0),n=this,r=function(){n.apply(this,arguments)};return r.prototype=new n,e.extend.apply(this,[r.prototype,n.prototype].concat(t)),r.extend=this.extend,r},e.UniqueIdsBase={_generateId:function(){return this._idCounter++,this._idCounter},_idCounter:-1},e.extend(e,e.UniqueIdsBase),e.makeMsgFilter=function(e){var n=[],r,i,s,o,u;e=e.slice(0);for(r=0,i=e.length;r<i;r++)s=t.exec(e[r]),s&&(o=parseInt(s[1],10),n.push([o-1,r]));return function(t){filtered=e.slice(0);for(r=0;u=n[r];r++){o=u[0];if(o>=t.length||o<0)throw new Error("$"+(o+1)+": argument number out of range");filtered[u[1]]=t[o]}return filtered}};var t=/^\$(\d+)$/;e.fillWithZeros=function(e,t){var n,r,t=t!==undefined?t:0;for(n=t,r=e.length;n<r;n++)e[n]=0},e.newBuffer=function(t){return t===undefined&&(t=1),new e.arrayType(e.blockSize*t)},e.notImplemented=function(){throw new Error("Not implemented !")}}.call(this),function(e){var t=function(e,t){this._sampleRate=e,this._blockSize=t,this._channelCount=2};e.extend(t.prototype,{getSampleRate:function(){e.notImplemented()},stop:function(){e.notImplemented()},play:function(t){e.notImplemented()},isPlaying:function(){e.notImplemented()}});var n=function(e,n){t.prototype.constructor.apply(this,arguments),this._sink=null,this._batchSize=4};e.extend(n.prototype,t.prototype,{getSampleRate:function(){if(this._sink)return this._sink.sampleRate;var e=Sink(null,this._channelCount,null,this._sampleRate);return e.sampleRate},stop:function(){this._sink.kill(),this._sink=null},play:function(e){var t=this,n=this._blockSize*this._batchSize*this._channelCount,r=this._channelCount*t._blockSize,i=Sink(null,this._channelCount,null,this._sampleRate),s=i.createProxy(n);this._sink=i,s.on("audioprocess",function(n){var i=0,s,o,u,a;for(s=0,o=t._batchSize;s<o;s++){u=0,a=e();for(i,u;u<r;i++,u++)n[i]=a[u]}}),i.on("error",function(e){console.error(e)})},isPlaying:function(){return this._sink!==null}}),e.AudioDriver=n}(this.Pd),function(e){var t=function(e,t){this.obj=e,this.id=t,this.init()};e.extend(t.prototype,{init:function(){},connect:function(t){e.notImplemented()},disconnect:function(t){e.notImplemented()},_genericConnect:function(e,t){if(e.indexOf(t)!==-1)return;e.push(t),t.connect(this)},_genericDisconnect:function(e,t){var n=e.indexOf(t);if(n===-1)return;e.splice(n,1),t.disconnect(this)}}),t.extend=e.chainExtend;var n=t.extend({init:function(){this.sources=[]},connect:function(e){this._genericConnect(this.sources,e),this.obj.emit("inletConnect")},disconnect:function(e){this._genericDisconnect(this.sources,e),this.obj.emit("inletDisconnect")},message:function(){this.obj.message.apply(this.obj,[this.id].concat(Array.prototype.slice.call(arguments)))},getBuffer:function(){e.notImplemented()},hasDspSources:function(){e.notImplemented()}}),r=t.extend({init:function(){this.sinks=[]},connect:function(e){this._genericConnect(this.sinks,e)},disconnect:function(e){this._genericDisconnect(this.sinks,e)},getBuffer:function(){e.notImplemented()},message:function(){e.notImplemented()}});e.inlet=n.extend({getBuffer:function(){throw new Error("No dsp buffer on a message inlet")},hasDspSources:function(){throw new Error("A message inlet cannot have dsp sources")}}),e["inlet~"]=n.extend({init:function(){n.prototype.init.apply(this,arguments),this.dspSources=[],this._buffer=e.newBuffer(),this._zerosBuffer=e.newBuffer(),e.fillWithZeros(this._zerosBuffer)},getBuffer:function(){var t=this.dspSources;if(t.length>1){var n=this._buffer,r,i,s,o,u;e.fillWithZeros(n);for(i=0,o=t.length;i<o;i++){r=t[i].getBuffer();for(s=0,u=n.length;s<u;s++)n[s]+=r[s]}return n}return t.length===1?t[0].getBuffer():this._zerosBuffer},connect:function(t){t instanceof e["outlet~"]&&this.dspSources.push(t),n.prototype.connect.apply(this,arguments)},disconnect:function(e){var t=this.dspSources.indexOf(e);t!==-1&&this.dspSources.splice(t,1),n.prototype.disconnect.apply(this,arguments)},hasDspSources:function(){return this.dspSources.length>0}}),e.outlet=r.extend({getBuffer:function(){throw new Error("No dsp buffer on a message outlet")},message:function(){var e=this.sinks,t,n,r;for(n=0,r=e.length;n<r;n++)t=e[n],t.message.apply(t,arguments)}}),e["outlet~"]=r.extend({init:function(){r.prototype.init.apply(this,arguments),this._buffer=e.newBuffer()},getBuffer:function(){return this._buffer},message:function(){throw new Error("message received on dsp outlet, pas bon")}})}(this.Pd),function(e){e.Object=function(t,n){this.patch=t||null,this.id=null,this.frame=-1,this._args=n=n||[],this._guiData={},this.inlets=[],this.outlets=[];var r=this.outletTypes,i=this.inletTypes,s,o;for(s=0,o=r.length;s<o;s++)this.outlets[s]=new e[r[s]](this,s);for(s=0,o=i.length;s<o;s++)this.inlets[s]=new e[i[s]](this,s);this.init.apply(this,n),this.type!=="abstract"&&(e.register(this),t&&t.addObject(this))},e.extend(e.Object.prototype,EventEmitter.prototype,e.UniqueIdsBase,{endPoint:!1,outletTypes:[],inletTypes:[],type:"abstract",i:function(e){if(e<this.inlets.length)return this.inlets[e];throw new Error("invalid inlet "+e)},o:function(e){if(e<this.outlets.length)return this.outlets[e];throw new Error("invalid outlet "+e)},init:function(){},load:function(){},dspTick:function(){},message:function(e,t){},assertIsNumber:function(t,n){if(!e.isNumber(t))throw new Error(n)},assertIsArray:function(t,n){if(!e.isArray(t))throw new Error(n)},assertIsString:function(t,n){if(!e.isString(t))throw new Error(n)},assertIsBang:function(e,t){if(e!=="bang")throw new Error(t)},dspTickNoOp:function(){},toDspTickNoOp:function(){this.dspTick=this.dspTickNoOp},dspTickZeros:function(){e.fillWithZeros(this.outlets[0].getBuffer())},toDspTickZeros:function(){this.dspTick=this.dspTickZeros},dspTickId:function(){var e=this.outlets[0].getBuffer(),t=this.inlets[0].getBuffer(),n,r;for(n=0,r=e.length;n<r;n++)e[n]=t[n]},toDspTickId:function(){this.dspTick=this.dspTickId}}),e.Object.extend=e.chainExtend;var t={setName:function(e){var t="unvalid name "+e,n=this.name;this.assertIsString(e,t);if(!e)throw new Error(t);this.name=e,this.emit("change:name",n,e)}};e.NamedObject=e.Object.extend(t),e.UniquelyNamedObject=e.Object.extend(t)}(this.Pd),function(e){e.Patch=function(){e.register(this),this.sampleRate=e.sampleRate,this.blockSize=e.blockSize,this.channelCount=e.channelCount,this._graph={objects:[],endPoints:[]},this._scheduled={},this.audio=new e.AudioDriver(this.sampleRate,this.blockSize),this.output=e.newBuffer(2),this.frame=0},e.extend(e.Patch.prototype,EventEmitter.prototype,e.UniqueIdsBase,{send:function(e){this.emit.apply(this,["msg:"+e].concat(Array.prototype.slice.call(arguments,1)))},receive:function(e,t){this.on("msg:"+e,t)},getAbsTime:function(){return this.frameToTime(this.frame)},frameToTime:function(e){return e*this.blockSize/(this.sampleRate/1e3)},timeToFrame:function(e){return e/(this.blockSize/(this.sampleRate/1e3))},timeout:function(e,t,n){return this._genericSchedule({callback:t,context:n,absTime:this.getAbsTime()+e,repeat:!1})},interval:function(e,t,n){return this._genericSchedule({callback:t,context:n,absTime:this.getAbsTime()+e,repeat:!0,time:e})},clear:function(e){var t,n,r,i;for(t in this._scheduled){n=this._scheduled[t],i=0;while(r=n[i]){if(r.id===e){n.splice(i,1);return}i++}}},_genericSchedule:function(e,t){if(!e.callback||!e.absTime)return;var n=Math.ceil(this.timeToFrame(e.absTime));cbs=this._scheduled[n]=this._scheduled[n]||[],cbs.push(e);if(t!==!0)return e.id=this._generateId()},generateFrame:function(){var t=this,n=this.output,r=this._scheduled[this.frame]||[],i,s;delete this._scheduled[this.frame],e.fillWithZeros(n),this.mapEndPoints(function(e){t.tick(e)}),this.frame++;for(i=0;s=r[i];i++)s.repeat&&(s.absTime+=s.time,this._genericSchedule(s,!0)),s.callback.call(s.context);return n},tick:function(t){if(t.frame<this.frame){var n=t.inlets,r,i,s,o,u;t.frame=this.frame;for(i=0,o=n.length;i<o;i++)if(n[i]instanceof e["inlet~"]){r=n[i].sources;for(s=0,u=r.length;s<u;s++)this.tick(r[s].obj)}t.dspTick&&t.dspTick()}},play:function(){var e=this;this.isPlaying()?console.debug("Already started."):(console.debug("Starting audio."),this.sampleRate=this.audio.getSampleRate(),this.mapObjects(function(e){e.load()}),this.audio.play(function(){return e.generateFrame()}),this.frame=0,this.mapObjects(function(e){e.frame=-1}))},stop:function(){this.isPlaying()?(console.debug("Stopping audio."),this.audio.stop()):console.debug("Already stopped.")},isPlaying:function(){return this.audio.isPlaying()},addObject:function(e){if(this._graph.objects.indexOf(e)===-1){var t=this._generateId();e.id=t,e.patch=this,this._graph.objects[t]=e,e.endPoint&&this._graph.endPoints.push(e),this.isPlaying()&&e.load(),console.debug("Added "+e.type+" to the graph at position "+t)}},removeObject:function(e){var t=this.getAllConnections(e),n=this._graph.endPoints.indexOf(e),r,i;for(r=0,i=t.length;r<i;r++)this.disconnect(t[r][0],t[r][1]);delete this._graph.objects[e.id],n!==-1&&this._graph.endPoints.splice(n,1)},getObject:function(e){return this._graph.objects[e]||null},mapObjects:function(e){this._map(this.getAllObjects(),e)},mapEndPoints:function(e){this._map(this._graph.endPoints,e)},connect:function(e,t){this._checkContainsObj(e.obj),this._checkContainsObj(t.obj),e.connect(t)},disconnect:function(e,t){this._checkContainsObj(e.obj),this._checkContainsObj(t.obj),e.disconnect(t)},getAllObjects:function(){var e=this._graph.objects,t=[],n,r,i;for(r=0,i=e.length;r<i;r++)e[r]&&t.push(e[r]);return t},getAllConnections:function(e){var t=[],n,r,i,s;if(e===undefined){var o=this.getAllObjects();for(r=0;r<o.length;r++){e=o[r];for(i=0;i<e.outlets.length;i++){n=e.o(i);for(s=0;s<n.sinks.length;s++)t.push([n,n.sinks[s]])}}}else{var u;for(i=0;i<e.outlets.length;i++){n=e.o(i);for(s=0;s<n.sinks.length;s++)t.push([n,n.sinks[s]])}for(i=0;i<e.inlets.length;i++){u=e.i(i);for(s=0;s<u.sources.length;s++)t.push([u.sources[s],u])}}return t},_checkContainsObj:function(e){if(this._graph.objects.indexOf(e)===-1)throw new Error("this object is not in the patch")},_map:function(e,t){for(var n=0,r=e.length;n<r;n++)t(e[n])}})}(this.Pd),function(e){e.objects={"null":{},cnv:{}},e.objects.text=e.Object.extend({load:function(e){this.text=e}}),e.objects.loadbang=e.Object.extend({outletTypes:["outlet"],load:function(){this.outlets[0].message("bang")}}),e.objects.print=e.Object.extend({inletTypes:["inlet"],init:function(e){this.printName=e||"print"},message:function(e){var t=Array.prototype.slice.call(arguments,1);console.log(this.printName+": "+t.join(" "))}}),e.objects.table=e.UniquelyNamedObject.extend({init:function(t,n){this.name=t||null,this.size=n,this.data=new e.arrayType(n)}}),e.objects.message=e.Object.extend({inletTypes:["inlet"],outletTypes:["outlet"],init:function(){this.setFilterMsg(Array.prototype.slice.call(arguments,0))},setFilterMsg:function(t){this.filterMsg=t,this.filter=e.makeMsgFilter(this.filterMsg)},message:function(e){if(e===0){var t=Array.prototype.slice.call(arguments,1),n,r;r=this.outlets[0],r.message.apply(r,this.filter(t))}}});var t=e.Object.extend({inletTypes:["inlet","inlet"],outletTypes:["outlet"],init:function(e){this.setVal(e||0),this.lastResult=0},setVal:function(e){this.assertIsNumber(e,"invalid constant value "+e),this.val=e},message:function(e,t){e===0?(t!=="bang"&&(this.assertIsNumber(t,"value must be a number"),this.lastResult=this.compute(t)),this.outlets[0].message(this.lastResult)):e===1&&this.setVal(t)},compute:function(e){return}});e.objects["+"]=t.extend({compute:function(e){return e+this.val}}),e.objects["-"]=t.extend({compute:function(e){return e-this.val}}),e.objects["*"]=t.extend({compute:function(e){return e*this.val}}),e.objects["/"]=t.extend({compute:function(e){return e/this.val}}),e.objects.mod=t.extend({compute:function(e){return e%this.val}}),e.objects["float"]=e.Object.extend({inletTypes:["inlet","inlet"],outletTypes:["outlet"],init:function(e){this.setVal(e||0)},setVal:function(e){this.assertIsNumber(e,"value must be a number"),this._dollarVal=!1,this.val=e},message:function(e,t){e===0?(this._dollarVal&&(t=Array.prototype.slice.call(arguments,1),t=this.filter(t)[0]),t!=="bang"&&this.setVal(t),this.outlets[0].message(this.val)):e===1&&this.setVal(t)}}),e.objects.spigot=e.Object.extend({inletTypes:["inlet","inlet"],outletTypes:["outlet"],init:function(e){this.setPassing(e||0)},setPassing:function(e){this.assertIsNumber(e,"value must be a number"),this.passing=Boolean(e)},message:function(e,t){if(e===0){if(this.passing){var n=this.outlets[0],r=Array.prototype.slice.call(arguments,1);n.message.apply(n,r)}}else e===1&&this.setPassing(t)}}),e.objects.trigger=e.Object.extend({inletTypes:["inlet"],outletTypes:[],init:function(){var t=Array.prototype.slice.call(arguments,0),n,r;t.length===0&&(t=["bang","bang"]);for(n=0,r=t.length;n<r;n++)this.outlets[n]=new e.outlet(this,n);this.filters=t},message:function(t,n){if(t===0){var r=Array.prototype.slice.call(arguments,1),i,s,o,u;for(i=this.filters.length-1;i>=0;i--){o=this.filters[i],u=this.outlets[i];if(o==="bang")u.message("bang");else if(o==="list"||o==="anything")u.message.apply(u,r);else if(o==="float")n=r[0],e.isNumber(n)?u.message(n):u.message(0);else if(o==="symbol"){n=r[0];if(n==="bang")u.message("symbol");else if(e.isNumber(n))u.message("float");else{if(!e.isString(n))throw new Error("Got unexpected input "+n);u.message(n)}}}}}}),e.objects.select=e.Object.extend({inletTypes:["inlet"],outletTypes:[],init:function(){var t=Array.prototype.slice.call(arguments,0),n,r;for(n=0,r=t.length;n<r;n++)this.outlets[n]=new e.outlet(this,n);this.outlets[n]=new e.outlet(this,n),this.filters=t},message:function(e,t){if(e===0){var n=this.filters,r,i;for(r=0,i=n.length;r<i;r++)if(t===n[r]){this.outlets[r].message("bang");return}this.outlets.slice(-1)[0].message(t)}}}),e.objects.moses=e.Object.extend({inletTypes:["inlet","inlet"],outletTypes:["outlet","outlet"],init:function(e){this.setVal(e||0),this.lastResult=0},setVal:function(e){this.assertIsNumber(e,"invalid constant value "+e),this.val=e},message:function(e,t){e===0?(this.assertIsNumber(t,"value must be a number"),t<this.val?this.outlets[0].message(t):this.outlets[1].message(t)):e===1&&this.setVal(t)}}),e.objects.mtof=e.Object.extend({inletTypes:["inlet"],outletTypes:["outlet"],maxMidiNote:8.17579891564*Math.exp(86.585635235),message:function(e,t){if(e===0){this.assertIsNumber(t,"invalid midi note "+t);var n=0;t<=-1500?n=0:t>1499?n=this.maxMidiNote:n=8.17579891564*Math.exp(.057762265*t),this.outlets[0].message(n)}}}),e.objects.random=e.Object.extend({inletTypes:["inlet","inlet"],outletTypes:["outlet"],init:function(e){this.setMax(e||1)},setMax:function(e){this.assertIsNumber(e,"invalid maximum "+e),this.max=e},message:function(e,t,n){e===0?t==="bang"?this.outputRandomInt():t==="seed":e===1&&this.setMax(t)},outputRandomInt:function(){this.outlets[0].message(Math.floor(Math.random()*this.max))}}),e.objects.metro=e.Object.extend({inletTypes:["inlet","inlet"],outletTypes:["outlet"],init:function(e){this.setRate(e||0),this.toDspTickNoOp(),this._intervalId=null,this._metroTick=this._metroTickNormal},setRate:function(e){this.assertIsNumber(e,"invalid rate "+e),this.rate=e},message:function(e,t){e===0?t==="bang"?this._restartMetroTick():t==="stop"?this._stopMetroTick():(this.assertIsNumber(t,"invalid msg "+t),t===0?this._stopMetroTick():this._restartMetroTick()):e===1&&(this.setRate(t),this._metroTick=this._metroTickRateChange)},_startMetroTick:function(){this._metroTick(),this._intervalId===null&&(this._intervalId=this.patch.interval(this.rate,function(){this._metroTick()},this))},_stopMetroTick:function(){this._intervalId!==null&&(this.patch.clear(this._intervalId),this._intervalId=null)},_restartMetroTick:function(){this._stopMetroTick(),this._startMetroTick()},_metroTickNormal:function(){this.outlets[0].message("bang")},_metroTickRateChange:function(){this._metroTick=this._metroTickNormal,this._restartMetroTick()}}),e.objects.delay=e.Object.extend({inletTypes:["inlet","inlet"],outletTypes:["outlet"],init:function(e){this.setDelay(e||0),this.toDspTickNoOp(),this._timeoutId=null},setDelay:function(e){this.assertIsNumber(e,"invalid delay "+e),this.delay=e},message:function(e,t){e===0?t==="bang"?(this._stopDelay(),this._startDelay()):t==="stop"?this._stopDelay():(this.setDelay(t),this._stopDelay(),this._startDelay()):e===1&&this.setDelay(t)},_startDelay:function(){this._timeoutId===null&&(this._timeoutId=this.patch.timeout(this.delay,this._delayReached,this))},_stopDelay:function(){this._timeoutId!==null&&(this.patch.clear(this._timeoutId),this._timeoutId=null)},_delayReached:function(){this.outlets[0].message("bang")}}),e.objects.timer=e.Object.extend({inletTypes:["inlet","inlet"],outletTypes:["outlet"],init:function(){this.refFrame=0},message:function(e,t){if(e===0)this.assertIsBang(t,"unvalid message : "+t),this.refFrame=this.patch.frame;else if(e===1){var n=this.patch;this.assertIsBang(t,"unvalid message : "+t),this.outlets[0].message((n.frame-this.refFrame)*n.blockSize*1e3/n.sampleRate)}}}),e.objects.receive=e.NamedObject.extend({inletTypes:[],outletTypes:["outlet"],init:function(e){var t=this._messageHandler();this.on("change:name",function(e,n){var r=this.patch;r&&(e&&r.removeListener("msg:"+e,t),r.on("msg:"+n,t))}),this.setName(e)},_messageHandler:function(){var e=this;return function(){var t=e.outlets[0];t.message.apply(t,arguments)}}}),e.objects.send=e.NamedObject.extend({inletTypes:["inlet"],outletTypes:[],init:function(e){this.setName(e)},message:function(e){if(e===0){var t=this.patch,n=Array.prototype.slice.call(arguments,1);t.send.apply(t,[this.name].concat(n))}}}),e.objects["list split"]=e.Object.extend({inletTypes:["inlet","inlet"],outletTypes:["outlet","outlet","outlet"],init:function(e){this.setSplitInd(e||0)},setSplitInd:function(e){this.assertIsNumber(e,"split point must be a number"),this.splitInd=e},message:function(e,t){if(e===0){var n=Array.prototype.slice.call(arguments,1);if(this.splitInd>n.length)this.outlets[2].message("bang");else{var r;this.splitInd===n.length?this.outlets[1].message("bang"):(r=this.outlets[1],r.message.apply(r,n.slice(this.splitInd,n.length))),this.splitInd===0?this.outlets[0].message("bang"):(r=this.outlets[0],r.message.apply(r,n.slice(0,this.splitInd)))}}else e===1&&this.setSplitInd(t)}}),e.objects["osc~"]=e.Object.extend({inletTypes:["inlet~","inlet"],outletTypes:["outlet~"],init:function(e){this.setFreq(e||0),this.phase=0,this.dspTick=this.dspTickConstFreq,this.on("inletConnect",this._onInletConnect),this.on("inletDisconnect",this._onInletDisconnect)},load:function(){this.setFreq(this.freq),this.J=2*Math.PI/this.patch.sampleRate},setFreq:function(e){this.assertIsNumber(e,"frequency must be a number"),this.freq=e,this.patch&&(this.K=2*Math.PI*this.freq/this.patch.sampleRate)},dspTickVariableFreq:function(){var e=this.inlets[0].getBuffer(),t=this.outlets[0].getBuffer(),n=this.J,r=this.phase,i,s;for(i=0,s=t.length;i<s;i++)r+=n*e[i],t[i]=Math.cos(r);this.phase=r},dspTickConstFreq:function(){var e=this.outlets[0].getBuffer(),t=this.K,n=this.phase,r,i;for(r=0,i=e.length;r<i;r++)n+=t,e[r]=Math.cos(n);this.phase=n},message:function(e,t){e===0?this.setFreq(t):e===1&&t==="bang"&&(this.phase=0)},_onInletConnect:function(){this.inlets[0].hasDspSources()&&(this.dspTick=this.dspTickVariableFreq)},_onInletDisconnect:function(){this.inlets[0].hasDspSources()||(this.dspTick=this.dspTickConstFreq)}}),e.objects["phasor~"]=e.Object.extend({inletTypes:["inlet~","inlet"],outletTypes:["outlet~"],init:function(e){this.setFreq(e||0),this.dspTick=this.dspTickConstFreq,this.phase=0,this.on("inletConnect",this._onInletConnect),this.on("inletDisconnect",this._onInletDisconnect)},load:function(){this.setFreq(this.freq),this.J=1/this.patch.sampleRate},setFreq:function(e){this.assertIsNumber(e,"frequency must be a number"),this.freq=e,this.patch&&(this.K=this.freq/this.patch.sampleRate)},dspTickVariableFreq:function(){var e=this.inlets[0].getBuffer(),t=this.outlets[0].getBuffer(),n=this.J,r=this.phase,i,s;for(i=0,s=t.length;i<s;i++)r=(r+n*e[i])%1,t[i]=r;this.phase=r},dspTickConstFreq:function(){var e=this.outlets[0].getBuffer(),t=this.K,n=this.phase,r,i;for(r=0,i=e.length;r<i;r++,n++)n=(n+t)%1,e[r]=n;this.phase=n},message:function(e,t){e===0?this.setFreq(t):e===1&&t==="bang"&&(this.phase=0)},_onInletConnect:function(){this.inlets[0].hasDspSources()&&(this.dspTick=this.dspTickVariableFreq)},_onInletDisconnect:function(){this.inlets[0].hasDspSources()||(this.dspTick=this.dspTickConstFreq)}}),e.objects["noise~"]=e.Object.extend({outletTypes:["outlet~"],dspTick:function(){var e=this.outlets[0].getBuffer(),t=this.J,n,r;for(n=0,r=e.length;n<r;n++)e[n]=2*Math.random()-1}}),e.objects["dac~"]=e.Object.extend({endPoint:!0,inletTypes:["inlet~","inlet~"],dspTick:function(){var e=this.inlets[0].getBuffer(),t=this.inlets[1].getBuffer(),n=this.patch.output,r,i;for(r=0,i=n.length;r<i;r++)n[r*2]+=e[r],n[r*2+1]+=t[r]}}),e.objects["line~"]=e.Object.extend({inletTypes:["inlet"],outletTypes:["outlet~"],init:function(){this.y0=0,this.y1=0,this.n=0,this.nMax=0,this.toDspConst(this.y0)},dspTickConst:function(){var e=this.outlets[0].getBuffer(),t,n,r=this.y0;for(t=0,n=e.length;t<n;t++)e[t]=r},dspTickLine:function(){var e=this.outlets[0].getBuffer(),t=e.length,n=this.slope,r,i;for(r=0;r<t;r++,this.n++){if(this.n>=this.nMax){for(i=r;i<t;i++)e[i]=this.y1;this.toDspConst(this.y1),this.emit("end");break}e[r]=this.n*n+this.y0}},message:function(e,t,n){e===0&&(this.assertIsNumber(t,"invalid value "+t),n!==undefined?(this.assertIsNumber(n,"invalid duration "+n),this.toDspLine(t,n)):this.toDspConst(t))},toDspConst:function(e){this.y0=e,this.dspTick=this.dspTickConst},toDspLine:function(e,t){this.y1=e,this.n=0,this.nMax=t*this.patch.sampleRate/1e3,this.slope=(this.y1-this.y0)/this.nMax,this.dspTick=this.dspTickLine}});var n=e.Object.extend({inletTypes:["inlet~","inlet~"],outletTypes:["outlet~"],init:function(e){this.setVal(e||0),this.dspTick=this.dspTickConstant,this.on("inletConnect",this._onInletConnect),this.on("inletDisconnect",this._onInletDisconnect)},setVal:function(e){this.assertIsNumber(e,"invalid constant value "+e),this.val=e},message:function(e,t){e===1&&this.setVal(t)},dspTickVariable:e.notImplemented,dspTickConstant:e.notImplemented,_onInletConnect:function(){this.inlets[1].hasDspSources()&&(this.dspTick=this.dspTickVariable)},_onInletDisconnect:function(){this.inlets[1].hasDspSources()||(this.dspTick=this.dspTickConstant)}});e.objects["*~"]=n.extend({dspTickVariable:function(){var e=this.inlets[0].getBuffer(),t=this.inlets[1].getBuffer(),n=this.outlets[0].getBuffer(),r,i;for(r=0,i=n.length;r<i;r++)n[r]=e[r]*t[r]},dspTickConstant:function(){var e=this.inlets[0].getBuffer(),t=this.outlets[0].getBuffer(),n=this.val,r,i;for(r=0,i=t.length;r<i;r++)t[r]=e[r]*n}}),e.objects["/~"]=n.extend({dspTickVariable:function(){var e=this.inlets[0].getBuffer(),t=this.inlets[1].getBuffer(),n=this.outlets[0].getBuffer(),r,i,s;for(i=0,s=n.length;i<s;i++)r=t[i],n[i]=r?e[i]/r:0},dspTickConstant:function(){var e=this.inlets[0].getBuffer(),t=this.outlets[0].getBuffer(),n=this.val,r,i;for(r=0,i=t.length;r<i;r++)t[r]=n?e[r]/n:0}}),e.objects["+~"]=n.extend({dspTickVariable:function(){var e=this.inlets[0].getBuffer(),t=this.inlets[1].getBuffer(),n=this.outlets[0].getBuffer(),r,i;for(r=0,i=n.length;r<i;r++)n[r]=e[r]+t[r]},dspTickConstant:function(){var e=this.inlets[0].getBuffer(),t=this.outlets[0].getBuffer(),n=this.val,r,i;for(r=0,i=t.length;r<i;r++)t[r]=e[r]+n}}),e.objects["-~"]=n.extend({dspTickVariable:function(){var e=this.inlets[0].getBuffer(),t=this.inlets[1].getBuffer(),n=this.outlets[0].getBuffer(),r,i;for(r=0,i=n.length;r<i;r++)n[r]=e[r]-t[r]},dspTickConstant:function(){var e=this.inlets[0].getBuffer(),t=this.outlets[0].getBuffer(),n=this.val,r,i;for(r=0,i=t.length;r<i;r++)t[r]=e[r]-n}});var r=e.Object.extend({init:function(e){this.tableName=e,this.table=null},load:function(){this.setTableName(this.tableName)},setTableName:function(t){var n=this.tableName;this.tableName=t;if(this.patch){var r=e.getUniquelyNamedObject("table",t);if(!r)throw new Error("table with name "+t+" doesn't exist");this.table=r}this.emit("change:tableName",n,t)}});e.objects["tabread~"]=r.extend({inletTypes:["inlet~"],outletTypes:["outlet~"],init:function(e){r.prototype.init.call(this,e),this.toDspTickZeros(),this.on("change:tableName",function(){this.dspTick=this.dspTickReading})},dspTickReading:function(){var e=this.outlets[0].getBuffer(),t=this.inlets[0].getBuffer(),n=this.table.size-1,r=this.table.data,i,s,o;for(s=0,o=e.length;s<o;s++)i=Math.floor(t[s]),e[s]=r[i>=0?i>n?n:i:0]},message:function(e,t,n){e===0&&t==="set"&&this.setTableName(n)}}),e.objects["tabread4~"]=r.extend({inletTypes:["inlet~"],outletTypes:["outlet~"],init:function(e){r.prototype.init.call(this,e),this.toDspTickZeros(),this.on("change:tableName",function(){this.dspTick=this.dspTickReading})},dspTickReading:function(){var e=this.outlets[0].getBuffer(),t=this.inlets[0].getBuffer(),n=this.table.size-1,r=this.table.data,i,s,o,u,a,f,l;for(f=0,l=e.length;f<l;f++)i=t[f],s=Math.floor(i),o=Math.ceil(i),s=s>=0?s>n?n:s:0,o=o>=0?o>n?n:o:0,s===o?e[f]=r[s]:(u=r[s],a=r[o],e[f]=u+(i-s)*(a-u))},message:function(e,t,n){e===0&&t==="set"&&this.setTableName(n)}}),e.objects["tabplay~"]=r.extend({inletTypes:["inlet"],outletTypes:["outlet~"],init:function(e){r.prototype.init.call(this,e),this.pos=0,this.posMax=0,this.toDspTickZeros()},dspTickReading:function(){var t=this.outlets[0].getBuffer(),n=Math.min(t.length,this.posMax-this.pos),r,i,s;for(r=0;r<n;r++,this.pos++)t[r]=this.table.data[this.pos];this.pos===this.posMax&&(e.fillWithZeros(t,r),this.toDspTickZeros(),this.emit("end"))},message:function(e,t,n){e===0&&(t==="set"?(this.setTableName(n),this.toDspTickZeros()):t==="bang"?this.toDspTickReading(0):t!==undefined&&(this.assertIsNumber(t,"not a valid start position "+t),n!==undefined?(this.assertIsNumber(n,"not a valid sample number "+n),this.toDspTickReading(t,n)):this.toDspTickReading(t)))},toDspTickReading:function(e,t){if(e>=this.table.size-1)return;t=t||this.table.size-e,this.pos=e,this.posMax=Math.min(e+t,this.table.size),this.dspTick=this.dspTickReading}}),e.objects["tabwrite~"]=r.extend({inletTypes:["inlet~"],endPoint:!0,init:function(e){r.prototype.init.call(this,e),this.pos=0,this.toDspTickNoOp()},dspTickWriting:function(){var e=this.inlets[0].getBuffer(),t=Math.min(e.length,this.table.size-this.pos);for(var n=0;n<t;n++,this.pos++)this.table.data[this.pos]=e[n];this.pos===this.table.size&&(this.toDspTickNoOp(),this.emit("end"))},message:function(e,t,n){if(e===0)if(t==="bang")this.toDspTickWriting(0);else if(t==="stop")this.toDspTickNoOp();else if(t==="set")this.setTableName(n),this.toDspTickNoOp();else if(t==="start"){var r=0;n!==undefined&&(this.assertIsNumber(n,"invalid start position "+n),r=Math.floor(n)),this.toDspTickWriting(r)}},toDspTickWriting:function(e){this.dspTick=this.dspTickWriting,this.pos=e}});var i,s;for(s in e.objects)if(i=e.objects[s].prototype)i.type=s}(this.Pd),function(e){var t=/ |\r\n?|\n/,n=/^\\(\$\d+)$/;e.compat={},e.compat.parseArg=function(t){var r=e.compat.parseFloat(t);if(e.isNumber(r))return r;if(e.isString(t)){var i;return(i=n.exec(t))?i[1]:t}throw new Error("couldn't parse arg "+t)},e.compat.parseFloat=function(t){return e.isNumber(t)?t:e.isString(t)?parseFloat(t):NaN},e.compat.parseArgs=function(n){if(e.isNumber(n))return[n];var r=e.isString(n)?n.split(t):n,i=[],s,o;for(s=0,o=r.length;s<o;s++){if((arg=r[s])==="")continue;i.push(e.compat.parseArg(arg))}return i};var r=/(#((.|\r|\n)*?)[^\\\\])\r{0,1}\n{0,1};\r{0,1}(\n|$)/gi;e.compat.parse=function(n){var i=null,s=0,o=new e.Patch,u;while(u=r.exec(n)){var a=u[1].split(t),f=a[0];if(f==="#X"){var l=a[1];if(l==="obj"||l==="msg"||l==="text"){var c,h,p,d=parseInt(a[2],10),v=parseInt(a[3],10);l==="msg"?(c="message",h=a.slice(4)):l==="text"?(c="text",h=[a.slice(4).join(" ")]):a[4]==="list"?(c=a[4]+" "+a[5],h=a.slice(6)):(c=a[4],h=a.slice(5));if(!e.objects.hasOwnProperty(c))throw new Error('unknown object "'+c+'"');p=new e.objects[c](o,e.compat.parseArgs(h)),p._guiData.x=d,p._guiData.y=v}else if(l==="array"){var m=a[2],g=parseInt(a[3],10),p=new e.objects.table(o,[m,g]);i=p}else if(l==="restore")i=null;else if(l==="connect"){var y=o.getObject(parseInt(a[2],10)),b=o.getObject(parseInt(a[4],10));o.connect(y.o(parseInt(a[3],10)),b.i(parseInt(a[5],10)))}}else if(f==="#A"){var w=parseInt(a[1],10),E,S;if(i){for(E=2,S=a.length;E<S;E++,w++)i.data[w]=parseFloat(a[E]);console.debug("read "+(a.length-1)+' floats into table "'+i.name+'"')}else console.error("got table data outside of a table.")}}return console.debug("Graph:"),console.debug(o),o}}(this.Pd);